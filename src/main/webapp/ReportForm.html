<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-150138651-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-150138651-1');
  </script>

  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>RemotePrint.tools</title>
  <meta content="" name="descriptison">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link rel=icon href="assets/img/printerFavicon.png">

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/icofont/icofont.min.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/venobox/venobox.css" rel="stylesheet">
  <link href="assets/vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet">
  <link href="assets/css/style.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.5.207/pdf.js"> </script>
  <style>
    .alertSuccess {
      padding: 20px;
      background-color: #80ba77;
      color: white;
      border-radius: 4px;
    }

    .alertFail {
      padding: 20px;
      background-color: #f44336;
      color: white;
      border-radius: 4px;
    }

    .closebtn {
      margin-left: 15px;
      color: white;
      font-weight: bold;
      float: right;
      font-size: 22px;
      line-height: 20px;
      cursor: pointer;
      transition: 0.3s;
    }

    .closebtn:hover {
      color: black;
    }
  </style>

</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="fixed-top">
    <div class="container d-flex align-items-center">

      <h1 class="logo mr-auto"><a href="index.html">RemotePrint.tools</a></h1>

      <nav class="nav-menu d-none d-lg-block">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li class="active"><a href="ReportForm.html"> Get Started </a></li>
          <li><a href="checkStatus.html"> Check Status </a></li>
          <li><a href="tandc.html"> T & C </a></li>
        </ul>
      </nav>




    </div>
  </header><!-- End Header -->

  <!-- ======= Hero Section ======= -->

  <!-- End Hero -->

  <main id="main">
    <!-- ======= Contact Section ======= -->
    <section id="contact" class="contact">
      <div class="container">

        <div class="section-title">
          <!-- <span>Report Print</span> -->
          <h2>Print Report</h2>
        </div>

        <div class="row">


          <div class="col-sm-6" style="object-fit: contain;">
            <img src="assets/img/FormArtWork.svg" alt="Workflow Diagram" style="object-fit: contain;width: 100%;">
          </div>
          <div class="col-sm-6">

            <form form action="submit" method="post" role="form" class="php-email-form" id="form-main">

              <div class="form-group">
                <label for="name">Full Name</label>
                <input type="text" class="form-control" name="name" data-rule="lenRange:4,30"
                  data-msg="Please enter a valid full name" />
                <div class="validate"></div>
              </div>

              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="name">Your Email</label>
                  <input type="email" class="form-control" name="email" data-rule="email"
                    data-msg="Please enter a valid email" />
                  <div class="validate"></div>
                </div>

                <div class="form-group col-md-6">
                  <label for="name">Phone Number</label>
                  <input type="text" id="phoneNumber" class="form-control" name="phoneNumber" data-rule="lenRange:10,10"
                    data-msg="Please enter a valid number" />
                  <div class="validate"></div>
                </div>
              </div>

              <div class="form-group">
                <label for="collegeName">Select College</label>
                <select class="form-control" name="college" id="collegeName">
                  <option>RV College of EngineeringÂ®</option>
                </select>
                <div class="validate"></div>
              </div>

              <div class="form-group">
                <label for="name">USN</label>
                <input type="text" id="USN" class="form-control" name="usn" data-rule="lenRange:10,11"
                  data-msg="Please enter a valid USN" />
                <div class="validate"></div>
              </div>

              <div class="form-group">
                <label for="name">Guide Name</label>
                <input type="text" class="form-control" name="guideName" data-rule="lenRange:3,20"
                  data-msg="Please fill this field" />
                <div class="validate"></div>
              </div>

              <div class="form-group">
                <label for="name">Department</label>
                <input type="text" class="form-control" name="department" data-rule="lenRange:3,30"
                  data-msg="Please fill this field" />
                <div class="validate"></div>
              </div>

              <div id="formatingOptions" class="form-group" disabled>
                <label for="name">Formatting Options</label>
                <hr>

                <div class="form-group">
                  <!-- Print Type  -->
                  <input type="radio" name="printType" value="draftCopy">
                  <label for="singleSided">Draft Copy &nbsp;&nbsp;</label>
                  <input type="radio" id="finalCopyOption" name="printType" value="finalCopy">
                  <label for="doubleSided">Final Copy (CSE)</label><button type="button" class="btn btn-link"
                      data-toggle="modal" data-target="#exampleModalCenter"><sup>
                      <img src="assets/img/info.svg"</sup>
                    </button>

                  <!-- Modal -->
                  <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog"
                    aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLongTitle">Final Copy</h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          Final Copy is currently available only for CSE as the format has been confirmed by the Department. The <strong>Final Copy</strong> option has the following formatting by default: <br><br>
                          <ul>
                            <li>A4 Size Bond Sheets</li>
                            <li>Single Sided</li>
                            <li>Color Print for all pages</li>
                            <li>OHP Sheets for Certificates and Chapters</li>
                            <li>Hard Binding with Light Pink Cover</li>
                          </ul>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="form-group" id="final">
                    <hr>
                    <label for="noCopies">Number of Copies</label>
                    <select class="form-control" name="numberOfCopies" id="noCopies">
                      <option selected>1</option>
                      <option>2</option>
                      <option>3</option>
                      <option>4</option>
                      <option>5</option>
                    </select>
                    <hr>
                  </div>


                  <div class="form-group" id="draft">
                    <!-- Print Color -->
                    <hr>
                    <input type="radio" name="color" value="10">
                    <label for="BW">Black & White &nbsp;&nbsp;&nbsp;&nbsp;</label>
                    <input type="radio" name="color" value="20">
                    <label for="color">Color</label><br>
                    <hr>

                    <!-- Single/Double Sided -->
                    <input type="radio" name="sides" value="1">
                    <label for="singleSided">Single Sided &nbsp;&nbsp;</label>
                    <input type="radio" name="sides" value="2">
                    <label for="doubleSided">Double Sided</label><br>
                    <input type="radio" name="sides" value="3">
                    <label for="doubleSided">Initial Pages (Single Sided) + Other Pages (Double Sided)</label><br>
                    <hr>

                    <!-- Spiral Bind Color -->
                    <label for="collegeName">Spiral Bind Color</label>
                    <select class="form-control" name="bindingColor" id="spiralBindColor">
                      <option>Light Yellow</option>
                      <option>Light Blue</option>
                      <option>Light Pink</option>
                      <option>Light Green</option>
                      <option>None</option>
                    </select>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group ">
                    <a class="get-started-btn" id="upload-button" style="margin-left: 5px;margin-right: 10px;">Select
                      File</a>
                    <input type="file" id="file-input" style="display: none;" accept=".pdf" />
                  </div>

                  <div class="form-group col-md-8">
                    <input type="text" class="form-control" name="fileNameActual" id="fileNameActual" disabled />
                  </div>

                </div>

                <div class="form-row">
                  <div id="Cost" style="font-size: large;display: none;">
                  </div>


                  <div class="grid-container">

                    <input type="hidden" class="form-control" name="fileName" id="fileName" value="" />
                    <input type="hidden" class="form-control" name="numberOfPages" id="numberOfPages" value="" />
                    <input type="hidden" class="form-control" name="cost" id="cost" value="" />

                    <div class="Payment">
                      <div class="form-row">
                        <div class="form-group col-md-6">
                          <img src="assets/img/UPILogo.png" alt="Workflow Diagram"
                            style="object-fit: contain;width: 100%;">
                        </div>
                        <div class="form-group col-md-6">
                          <button class="get-started-btn text-center" id="pay-button"
                            style="margin-left: 0px;">Pay</button>
                        </div>
                      </div>
                      <div class="Cost">
                        <br><strong>
                          <div id="uniqueFileNameLabel" style="font-size: large;"></div>
                        </strong>
                        <br><strong>
                          <div id="vpa" style="font-size: large;" di></div>
                        </strong>
                      </div>
                    </div>


                    <div class="QRcode">
                      <div id="QRCode" class="text-center" style="display: none"></div>
                    </div>

                  </div>
                </div>



                <div class="form-group">
                  <label for="transactionId">12 Digit UPI Transaction ID (UTR)</label>
                  <input type="text" class="form-control" name="transactionId" data-rule="lenRange:12,12"
                    data-msg="Please fill the 12 digit Transaction ID" />
                  <div class="validate"></div>
                </div>

                <div class="form-group">
                  <input type="checkbox" value="Bike" id="tandc">
                  <label for="tandc">I have read and I agree with the <a href="tandc.html" target="_blank">terms and
                      conditions</a>.</label><br>
                </div>



                <div class="form-group text-center">
                  <button type="submit" id="submit-button" method="post">Submit</button>
                </div>
                <div class="mb-3">
                  <div class="loading">Loading</div>
                  <div class="error-message">Oops! There seems to be a networking issue.</div>
                  <div class="sent-message">Awesome! Your submission has been recorded. You will recieve an email
                    shortly.
                  </div>
                </div>
            </form>

          </div>

        </div>

      </div>
    </section>
    <!-- End Contact Section -->

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">



    <div class="container footer-top">
      <div class="copyright">
        &copy; Copyright <strong><span>RemotePrint.tools</span></strong>. All Rights Reserved <strong>Contact us at
          remoteprint.tools@gmail.com<strong>
      </div>
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top"><i class="icofont-simple-up"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/js/azure-storage-blob.js" charset="utf-8"></script>
  <script src="https://cdnjs.com/libraries/pdf.js" charset="utf-8"></script>
  <script src="assets/vendor/jquery/jquery.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/jquery.easing/jquery.easing.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/waypoints/jquery.waypoints.min.js"></script>
  <script src="assets/vendor/counterup/counterup.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/venobox/venobox.min.js"></script>
  <script src="assets/vendor/owl.carousel/owl.carousel.min.js"></script>

  <script src="assets/js/main.js"></script>
  <script>
    // You'll add code here in the following sections.
    const selectButton = document.getElementById("upload-button");
    const payButton = document.getElementById("pay-button");
    const fileInput = document.getElementById("file-input");
    const fileSelector = document.getElementById('file-input');
    const submitButton = document.getElementById('submit-button');
    const costLabel = document.getElementById("Cost")
    const formatingOptions = document.getElementById("formatingOptions")
    const draft = document.getElementById("draft");
    const final = document.getElementById("final");
    const finalCopyOption = document.getElementById("finalCopyOption");
    var x = document.getElementById("tandc").required = true;
    var numberOfCopies = document.getElementById("noCopies");
    var fileName;
    var count = 1;
    var cost;
    var upiName = 'print';
    var bankName = 'jio';
    var phoneNumber = "";
    var USN = "";
    draft.style.display = 'none';
    final.style.display = 'none';
    submitButton.disabled = true;
    payButton.disabled = true;
    var isCountUpdated = false;

    //Event Listeners
    selectButton.addEventListener("click", () => fileInput.click());
    payButton.addEventListener("click", initiatePayment);

    var color = document.getElementsByName('color');
    for (var i = 0; i < color.length; i++) {
      color[i].onclick = function () {
        calculateCost()
      }
    }
    var printType = document.getElementsByName('printType');


    var sides = document.getElementsByName('sides');
    for (var i = 0; i < sides.length; i++) {
      sides[i].onclick = function () {
        calculateCost()

      }
    }


    for (var i = 0; i < printType.length; i++) {
      printType[i].onclick = function () {
        openSesame()
      }
    }

    function openSesame() {
      var printTypeValue;
      for (var i = 0; i < printType.length; i++) {
        if (printType[i].checked) {
          printTypeValue = printType[i].value;
        }
      }

      if (printTypeValue == "draftCopy") {
        draft.style.display = ''
        final.style.display = 'none'
      } else {
        draft.style.display = 'none'
        final.style.display = ''
      }
      calculateCost()
    }



    function generateSegment(length) {
      var result = '';
      var characters = 'abcdefghijklmnopqrstuvwxyz';
      var charactersLength = characters.length;
      for (var i = 0; i < length; i++) {
        result += characters.charAt(Math.floor(Math.random() * charactersLength));
      }
      return result;
    }

    function generateUniqueID() {
      return generateSegment(4) + '-' + generateSegment(4)
    }

    function initiatePayment() {
      fileName = generateUniqueID()
      setFileName()
      uploadFiles()
      generateQRCode()
      document.getElementById("QRCode").style.display = ''
      submitButton.disabled = false;
      payButton.disabled = true;
      document.getElementById("vpa").innerHTML = 'VPA : print@jio'
      disableRadioButtons()
    }

    function disableRadioButtons() {
      var color = document.getElementsByName('color');
      for (var i = 0; i < color.length; i++) {
        color[i].readOnly = true;
      }

    }

    function setFileName() {
      var fileNameText = document.getElementById("uniqueFileNameLabel")
      fileNameText.innerHTML = "Unique ID : " + fileName;
      var fileNameInput = document.getElementById("fileName");
      fileNameInput.value = fileName;
    }
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.5.207/pdf.worker.js';
    fileSelector.addEventListener('change', (event) => {
      isCountUpdated = false;
      const fileList = event.target.files;
      var reader = new FileReader();
      var file = event.target.files[0];
      reader.readAsBinaryString(fileList[0]);
      var fileReader = new FileReader();
      fileReader.readAsArrayBuffer(file);

      fileReader.onload = function () {
        var typedarray = new Uint8Array(this.result);
        const loadingTask = pdfjsLib.getDocument(typedarray);
        loadingTask.promise.then(pdf => {
          count = pdf._pdfInfo.numPages
          isCountUpdated = true;
          document.getElementById("numberOfPages").value = count
          console.log("Number of Pages from moz: " + count);
          calculateCost();
        })
      }

      submitButton.disabled = true;
      resetPaymentInfo();
      reader.onloadend = function () {
        countOld = reader.result.match(/\/Type[\s]*\/Page[^s]/g).length;

        console.log('Number of Pages:', countOld);
        document.getElementById("fileNameActual").value = fileInput.files[0].name
        document.getElementById("numberOfPages").value = count
        calculateCost()
        document.getElementById("Cost").style.display = ''
        try {
          if (fileInput.files[0].name) {
            payButton.disabled = false;

          }
        } catch {
          console("File Not Selected Exception")
        }
      }
    });





    function resetPaymentInfo() {
      costLabel.innerHTML = '';
      document.getElementById("QRCode").style.display = 'none';
      document.getElementById("uniqueFileNameLabel").innerHTML = ''
      document.getElementById("vpa").innerHTML = ''


    }
    document.getElementById("spiralBindColor").onchange = function () {
      calculateCost()
    }
    numberOfCopies.onchange = function () {
      calculateCost()
    }

    function calculateCost() {

      var spiralBindCost = 30
      var costMap = new Map()
      var bw1sps = 1.5
      var bw2sps = 1
      var c1sps = 5.5
      var c2sps = 4
      var surcharge = 5
      spiralBindCost = (document.getElementById("spiralBindColor").value == "None") ? 0 : 30;
      var baseCharge = 30;
      var c1spsf = 5
      var t1spsf = 5
      var hardBind = 65
      var frontPage = 10


      costMap.set("101", bw1sps)
      costMap.set("102", bw2sps)
      costMap.set("201", c1sps)
      costMap.set("202", c2sps)

      var color = document.getElementsByName('color');
      var colorValue;
      for (var i = 0; i < color.length; i++) {
        if (color[i].checked) {
          colorValue = color[i].value;
        }
      }

      var sides = document.getElementsByName('sides');
      var sidesValue;
      for (var i = 0; i < sides.length; i++) {
        if (sides[i].checked) {
          sidesValue = sides[i].value;
        }
      }

      var typeValue = colorValue + sidesValue

      if (typeValue != "103" && typeValue != "203") {
        cost = count * costMap.get(colorValue + sidesValue) + spiralBindCost
      } else {
        cost = 12 * costMap.get(colorValue + "1") + (count - 12) * costMap.get(colorValue + "2") + spiralBindCost +
          surcharge
      }

      if (cost <= 30) {
        cost = baseCharge;
      }
      if (finalCopyOption.checked && isCountUpdated) {
        cost = (((count) * c1spsf) + 15 * t1spsf + hardBind + frontPage) * numberOfCopies.value;
      }
      cost = cost.toFixed(2);
      costLabel.innerHTML = '<strong>  Estimated Cost : &#8377 ' + cost + '</strong>';
      document.getElementById("cost").value = cost
      generateQRCode()
    }


    function generateQRCode() {
      USN = document.getElementById("USN").value;
      phoneNumber = document.getElementById("phoneNumber").value;

      document.getElementById("QRCode").innerHTML =
      '<img src="https://chart.googleapis.com/chart?cht=qr&chs=200x200&chl=upi%3A%2F%2Fpay%3Fpa%3D' + upiName + '%40' + bankName + '%26pn%3DRemotePrint.tools%26am%3D' + cost + '%26cu%3DINR%26tn%3D' + fileName + '%2520' + USN + '%2520' + phoneNumber + '">'
    }

    //AZURE FUNCTIONS START
    const accountName = "reportprintstorage";
    const sasString =
      "?sv=2019-10-10&ss=b&srt=sco&sp=wx&se=2020-08-30T03:26:10Z&st=2020-06-08T19:26:10Z&sip=0.0.0.0-255.255.255.255&spr=https&sig=ag314dUSt9%2B64VfqJpZ%2BI9RNq1gZYvA6%2FbAlSvIq3Eg%3D";
    const containerName = "testcontainer";
    const containerURL = new azblob.ContainerURL(
      `https://${accountName}.blob.core.windows.net/${containerName}?${sasString}`,
      azblob.StorageURL.newPipeline(new azblob.AnonymousCredential));

    const uploadFiles = async () => {
      try {
        const promises = [];

        for (const file of fileInput.files) {
          var filetype = file.name.split("\.")[1];
          if (file.type == "application/pdf") {
            const blockBlobURL = azblob.BlockBlobURL.fromContainerURL(containerURL, fileName + ".pdf");
            promises.push(azblob.uploadBrowserDataToBlockBlob(
              azblob.Aborter.none, file, blockBlobURL));
          } else {
            //error comment for wrong file
          }
        }
        await Promise.all(promises);
      } catch (error) {
        console.log('Error in Azure Upload Function');
      }
    }
    var fullForm = document.getElementById("form-main");

    //AZURE FUNCTIONS END
  </script>

  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

</body>

</html>
